"use strict";(()=>{var g=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var D=g(y=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0});y.findMatches=y.applyRule=y.validateGrid=void 0;var z=/[BIPENDAWROYGUSKF\ /]+/;function G(e){for(let t=0;t<e.rules.length;t++){let n=e.rules[t];if(typeof n=="string"){e.rules[t]=n.replace(/\s+/," ");continue}}if(e.type==="2d"){let t=e.grid.input[0].length;for(let n of e.grid.input){if(!z.test(n))throw new Error('Grid row contains invalid characters. May only contain "BIPENDAWROYGUSKF" ');if(n.length!==t)throw new Error("2D grid is not uniform")}}if(e.type==="3d"){let t=e.grid.input[0][0].length;for(let n of e.grid.input)for(let s of n){if(!z.test(s))throw new Error('Grid row contains invalid characters. May only contain "BIPENDAWROYGUSKF" ');if(s.length!==t)throw new Error("3D grid is not uniform")}}}y.validateGrid=G;function I(e,{from:t,to:n},s){if(e.type==="2d"){let o={x:s.x,y:s.y},a;for(let f=0;f<t.length;f++){let u=n[f];a=a?M(e.grid.input,o,a,s.dir,u):{...o},x(u)&&(u=n[++f]),e.grid.input[a.y]=b(e.grid.input[a.y],a.x,u)}return}let r={x:s.x,y:s.y,z:s.z},i;for(let o=0;o<t.length;o++){let a=n[o];i=i?k(e.grid.input,r,i,s.dir,a):{...r},x(a)&&(a=n[++o]),e.grid.input[i.z][i.y]=b(e.grid.input[i.z][i.y],i.x,a)}}y.applyRule=I;function q(e,t){let n=[];if(e.type==="2d"){for(let s=0;s<e.grid.input.length;s++)for(let r=0;r<e.grid.input[0].length;r++)n.push(...L(e,t,r,s));return n}for(let s=0;s<e.grid.input.length;s++)for(let r=0;r<e.grid.input[0].length;r++)for(let i=0;i<e.grid.input[0][0].length;i++)n.push(...A(e,t,i,r,s));return n}y.findMatches=q;var S=["x+1","x-1","y+1","y-1"],_=["x+1","x-1","y+1","y-1","z+1","z-1"];function L(e,{from:t},n,s){let r=[],i={x:n,y:s};for(let o of S){let a,f=!0;for(let u=0;u<t.length;u++){let l=t[u];if(a=a?M(e.grid.input,i,a,o,l):{x:n,y:s},!a){f=!1;break}if(x(l)&&(l=t[++u]),e.unions[l]&&e.unions[l].has(e.grid.input[a.y][a.x]))break;if(l!=="*"&&l!==e.grid.input[a.y][a.x]){f=!1;break}}f&&r.push({x:n,y:s,dir:o})}return r}function A(e,{from:t},n,s,r){let i=[],o={x:n,y:s,z:r};for(let a of _){let f,u=!0;for(let l=0;l<t.length;l++){let c=t[l];if(f=f?k(e.grid.input,o,f,a,c):{x:n,y:s,z:r},!f){u=!1;break}if(x(c)&&(c=t[++l]),e.unions[c]&&!e.unions[c].has(e.grid.input[f.z][f.y][f.x])){u=!1;break}if(c!=="*"&&c!==e.grid.input[f.z][f.y][f.x]){u=!1;break}}u&&i.push({x:n,y:s,z:r,dir:a})}return i}function M(e,t,n,s,r){let i;if(x(r)&&(i=F(t,n,s)),!i)switch(s){case"x-1":{i={x:n.x-1,y:n.y};break}case"x+1":{i={x:n.x+1,y:n.y};break}case"y-1":{i={x:n.x,y:n.y-1};break}case"y+1":{i={x:n.x,y:n.y+1};break}}if(!(i.x<0||i.y<0||i.x>=e[0].length||i.y>=e.length))return i}function F(e,t,n){let s;switch(n){case"x-1":s={x:e.x,y:t.y-1};break;case"x+1":s={x:e.x,y:t.y+1};break;case"y-1":s={x:t.x+1,y:e.y};break;case"y+1":s={x:t.x-1,y:e.y};break}return s}function k(e,t,n,s,r){let i;switch(x(r)?i=T(t,n,s):Y(r)&&(i=W(t,n,s)),s){case"x-1":{i={x:n.x-1,y:n.y,z:n.z};break}case"x+1":{i={x:n.x+1,y:n.y,z:n.z};break}case"y-1":{i={x:n.x,y:n.y-1,z:n.z};break}case"y+1":{i={x:n.x,y:n.y+1,z:n.z};break}case"z-1":{i={x:n.x,y:n.y,z:n.z-1};break}case"z+1":{i={x:n.x,y:n.y,z:n.z+1};break}}return P(e,i)?i:void 0}function P(e,t){return!(t.x<0||t.y<0||t.z<0||t.x>=e[0][0].length||t.y>=e[0].length||t.z>=e.length)}function W(e,t,n){switch(n){case"x-1":return{x:e.x,y:t.y,z:t.z-1};case"x+1":return{x:e.x,y:t.y,z:t.z+1};case"y-1":return{x:t.x,y:e.y,z:t.z-1};case"y+1":return{x:t.x,y:e.y,z:t.z+1};case"z-1":return{x:t.x+1,y:t.y,z:e.x};case"z+1":return{x:t.x-1,y:t.y,z:e.x}}}function T(e,t,n){switch(n){case"x-1":return{x:e.x,y:t.y-1,z:t.z};case"x+1":return{x:e.x,y:t.y+1,z:t.z};case"y-1":return{x:t.x+1,y:e.y,z:t.z};case"y+1":return{x:t.x-1,y:e.y,z:t.z};case"z-1":return{x:t.x,y:t.y-1,z:e.z};case"z+1":return{x:t.x,y:t.y+1,z:e.z}}}function b(e,t,n){return n==="*"&&(n=e[t]),e.slice(0,t)+n+e.slice(t+1)}function Y(e){return e===" "}function x(e){return e==="/"}});var E=g(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0});h.processSequences=h.slowGenerate=h.generate=void 0;var p=D(),d=0;function B(e){(0,p.validateGrid)(e);let t={...e,...w(e.rules),count:0,rule:-1,id:0};for(let n of t.sequences)for(;;){let s=!1;for(let r of n.rules)console.log(r.from,r.to),s=v(t,n,r,s);if(!s)break}return t}h.generate=B;function j(e,t,n){let s=16.666666666666668,r=0;(0,p.validateGrid)(e);let i={...e,...w(e.rules),count:0,rule:-1,id:++d};r=Date.now()+s;let o=async()=>{Date.now()>=r&&(t(i),await m(0),r+=s)},a=async()=>{for(let u of i.sequences)for(i.rule++;d===i.id;){let l=!1;for(let c of u.rules){if(d!==i.id)return;if(l=v(i,u,c,l),await o(),u.type==="standard"&&l)break}if(!l)break}t(i),n?.(i),f()},f=()=>{i.rule=-1,i.id=-1};return a(),{stop:f}}h.slowGenerate=j;function m(e=0){return new Promise(t=>setTimeout(t,e))}function v(e,t,n,s){if(n.steps.max&&!n.steps.all&&n.steps.count>=n.steps.max)return s||!1;e.count++;let r=(0,p.findMatches)(e,n);if(r.length===0)return s||!1;if(n.steps.all){for(let i of r)(0,p.applyRule)(e,n,i);e.count+=r.length,n.steps.count=1/0}else{let i=Math.floor(Math.random()*r.length),o=r[i];if(n.steps.count++,(0,p.applyRule)(e,n,o),t.type==="one")return!0}return!0}function w(e,t=!0){let n=[],s={};for(let r of e){if(r.toLowerCase().startsWith("union")||r.toLowerCase().startsWith("symbol")){let[,...i]=r.split(" ");if(!i.length)continue;let[o,a]=i.join("").split("=").map(f=>f.trim());if(!o||!a)continue;if(o.length>1&&t)throw new Error("Invalid union symbol: Must be only one character. ({SYMBOL}={UNION})");s[o]=new Set(a.split(""));continue}n.push(C(r,t))}return{sequences:n,unions:s}}h.processSequences=w;function C(e,t=!0){let n={type:"standard",rules:[]};e.toLowerCase().startsWith("one")&&(n.type="one",e=e.slice(3).trim());for(let s of U(e)){let[r,i]=s.split(" "),o=r.split("=");if(o[0]===o[1])continue;if(o.length!==2){if(t)throw new Error("Rules must follow format: {FROM}={TO}");o.push("")}let a={type:"one",from:o[0],to:o[1],steps:K(i,t)};if(a.steps.all&&(a.type="all"),o[0].length!==o[1].length&&t)throw new Error(`{FROM} and {TO} patterns must be equal in length: ${r}`);for(let f=0;f<o[0].length;f++)if((o[0][f]==="/"&&o[1][f]!=="/"||o[0][f]!=="/"&&o[1][f]==="/")&&t)throw new Error(`Step characters (/) must occur in the same positions: ${r}`);n.rules.push(a)}return n}function U(e){return e.split(",").map(t=>t.trim())}function K(e,t=!0){let n={count:0};if(!e)return n;if(e.startsWith("#")===!1){if(t)throw new Error(`Steps must start with '#', (${e})`);return n}if(e==="#ALL")return n.all=!0,n;if(e.includes("..")){let r=e.split(".."),[i,o]=[Number(r[0]),Number(r[1])];if(isNaN(i)||isNaN(o)){if(t)throw new Error("Step range must be formatted: #{FROM}..{TO}");return n}if(i>o||i<0||o<0){if(t)throw new Error("Invalid step range: {FROM} must be below {TO} and both values must be above 0");return n}return n.max=R(i,o),n.seed=()=>R(i,o),n}let s=Number(e.slice(1));if(isNaN(s)){if(t)throw new Error("Invalid step: Must follow be one of: #ALL, #{int}, #{from}..{to}");return n}return n.max=s,n}function R(e,t){return Math.floor(Math.random()*(t-e+1)+e)}});var $=g(O=>{Object.defineProperty(O,"__esModule",{value:!0});var N=E();onmessage=({data:{model:e,type:t}})=>{if(t==="slow"){(0,N.slowGenerate)(e,s=>postMessage(s));return}let n=(0,N.generate)(e);postMessage(n)}});$();})();
//# sourceMappingURL=grids.js.map
