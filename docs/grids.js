"use strict";(()=>{var g=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var D=g(y=>{"use strict";Object.defineProperty(y,"__esModule",{value:!0});y.findMatches=y.applyRule=y.validateGrid=void 0;var z=/[BIPENDAWROYGUSKF\ /]+/;function I(e){for(let t=0;t<e.rules.length;t++){let n=e.rules[t];if(typeof n=="string"){e.rules[t]=n.replace(/\s+/," ");continue}}if(e.type==="2d"){let t=e.grid.input[0].length;for(let n of e.grid.input){if(!z.test(n))throw new Error('Grid row contains invalid characters. May only contain "BIPENDAWROYGUSKF" ');if(n.length!==t)throw new Error("2D grid is not uniform")}}if(e.type==="3d"){let t=e.grid.input[0][0].length;for(let n of e.grid.input)for(let i of n){if(!z.test(i))throw new Error('Grid row contains invalid characters. May only contain "BIPENDAWROYGUSKF" ');if(i.length!==t)throw new Error("3D grid is not uniform")}}}y.validateGrid=I;function q(e,{from:t,to:n},i){if(e.type==="2d"){let o={x:i.x,y:i.y},a;for(let f=0;f<t.length;f++){let u=n[f];a=a?M(e.grid.input,o,a,i.dir,u):{...o},p(u)&&(u=n[++f]),e.grid.input[a.y]=b(e.grid.input[a.y],a.x,u)}return}let r={x:i.x,y:i.y,z:i.z},s;for(let o=0;o<t.length;o++){let a=n[o];s=s?k(e.grid.input,r,s,i.dir,a):{...r},p(a)&&(a=n[++o]),e.grid.input[s.z][s.y]=b(e.grid.input[s.z][s.y],s.x,a)}}y.applyRule=q;function S(e,t){let n=[];if(e.type==="2d"){for(let i=0;i<e.grid.input.length;i++)for(let r=0;r<e.grid.input[0].length;r++)n.push(...m(e,t,r,i));return n}for(let i=0;i<e.grid.input.length;i++)for(let r=0;r<e.grid.input[0].length;r++)for(let s=0;s<e.grid.input[0][0].length;s++)n.push(...A(e,t,s,r,i));return n}y.findMatches=S;var _=["x+1","x-1","y+1","y-1"],L=["x+1","x-1","y+1","y-1","z+1","z-1"];function m(e,{from:t},n,i){let r=[],s={x:n,y:i};for(let o of _){let a,f=!0;for(let u=0;u<t.length;u++){let l=t[u];if(a=a?M(e.grid.input,s,a,o,l):{x:n,y:i},!a){f=!1;break}if(p(l)&&(l=t[++u]),e.unions[l]&&e.unions[l].has(e.grid.input[a.y][a.x]))break;if(l!=="*"&&l!==e.grid.input[a.y][a.x]){f=!1;break}}f&&r.push({x:n,y:i,dir:o})}return r}function A(e,{from:t},n,i,r){let s=[],o={x:n,y:i,z:r};for(let a of L){let f,u=!0;for(let l=0;l<t.length;l++){let c=t[l];if(f=f?k(e.grid.input,o,f,a,c):{x:n,y:i,z:r},!f){u=!1;break}if(p(c)&&(c=t[++l]),e.unions[c]&&!e.unions[c].has(e.grid.input[f.z][f.y][f.x])){u=!1;break}if(c!=="*"&&c!==e.grid.input[f.z][f.y][f.x]){u=!1;break}}u&&s.push({x:n,y:i,z:r,dir:a})}return s}function M(e,t,n,i,r){let s;if(p(r)&&(s=W(t,n,i)),!s)switch(i){case"x-1":{s={x:n.x-1,y:n.y};break}case"x+1":{s={x:n.x+1,y:n.y};break}case"y-1":{s={x:n.x,y:n.y-1};break}case"y+1":{s={x:n.x,y:n.y+1};break}}if(!(s.x<0||s.y<0||s.x>=e[0].length||s.y>=e.length))return s}function W(e,t,n){let i;switch(n){case"x-1":i={x:e.x,y:t.y-1};break;case"x+1":i={x:e.x,y:t.y+1};break;case"y-1":i={x:t.x+1,y:e.y};break;case"y+1":i={x:t.x-1,y:e.y};break}return i}function k(e,t,n,i,r){let s;switch(p(r)?s=T(t,n,i):Y(r)&&(s=P(t,n,i)),i){case"x-1":{s={x:n.x-1,y:n.y,z:n.z};break}case"x+1":{s={x:n.x+1,y:n.y,z:n.z};break}case"y-1":{s={x:n.x,y:n.y-1,z:n.z};break}case"y+1":{s={x:n.x,y:n.y+1,z:n.z};break}case"z-1":{s={x:n.x,y:n.y,z:n.z-1};break}case"z+1":{s={x:n.x,y:n.y,z:n.z+1};break}}return F(e,s)?s:void 0}function F(e,t){return!(t.x<0||t.y<0||t.z<0||t.x>=e[0][0].length||t.y>=e[0].length||t.z>=e.length)}function P(e,t,n){switch(n){case"x-1":return{x:e.x,y:t.y,z:t.z-1};case"x+1":return{x:e.x,y:t.y,z:t.z+1};case"y-1":return{x:t.x,y:e.y,z:t.z-1};case"y+1":return{x:t.x,y:e.y,z:t.z+1};case"z-1":return{x:t.x+1,y:t.y,z:e.x};case"z+1":return{x:t.x-1,y:t.y,z:e.x}}}function T(e,t,n){switch(n){case"x-1":return{x:e.x,y:t.y-1,z:t.z};case"x+1":return{x:e.x,y:t.y+1,z:t.z};case"y-1":return{x:t.x+1,y:e.y,z:t.z};case"y+1":return{x:t.x-1,y:e.y,z:t.z};case"z-1":return{x:t.x,y:t.y-1,z:e.z};case"z+1":return{x:t.x,y:t.y+1,z:e.z}}}function b(e,t,n){return n==="*"&&(n=e[t]),e.slice(0,t)+n+e.slice(t+1)}function Y(e){return e===" "}function p(e){return e==="/"}});var N=g(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0});h.processSequences=h.slowGenerate=h.generate=void 0;var x=D(),d=0;function j(e){(0,x.validateGrid)(e);let t={...e,...w(e.rules),count:0,rule:-1,id:0};for(let n of t.sequences)for(;;){let i=!1;n.type==="random"&&E(n.rules);for(let r of n.rules)i=v(t,n,r,i);if(!i)break}return t}h.generate=j;function B(e,t,n){let i=16.666666666666668,r=0;(0,x.validateGrid)(e);let s={...e,...w(e.rules),count:0,rule:-1,id:++d};r=Date.now()+i;let o=async()=>{Date.now()>=r&&(t(s),await C(0),r+=i)},a=async()=>{for(let u of s.sequences)for(s.rule++;d===s.id;){let l=!1;u.type==="random"&&E(u.rules);for(let c of u.rules){if(d!==s.id)return;if(l=v(s,u,c,l),await o(),u.type!=="one"&&l)break}if(!l)break}t(s),n?.(s),f()},f=()=>{s.rule=-1,s.id=-1};return a(),{stop:f}}h.slowGenerate=B;function C(e=0){return new Promise(t=>setTimeout(t,e))}function v(e,t,n,i){if(n.steps.max&&!n.steps.all&&n.steps.count>=n.steps.max)return i||!1;e.count++;let r=(0,x.findMatches)(e,n);if(r.length===0)return i||!1;if(n.steps.all){for(let s of r)(0,x.applyRule)(e,n,s);e.count+=r.length,n.steps.count=1/0}else{let s=Math.floor(Math.random()*r.length),o=r[s];if(n.steps.count++,(0,x.applyRule)(e,n,o),t.type==="one")return!0}return!0}function w(e,t=!0){let n=[],i={};for(let r of e){if(r.toLowerCase().startsWith("union")||r.toLowerCase().startsWith("symbol")){let[,...s]=r.split(" ");if(!s.length)continue;let[o,a]=s.join("").split("=").map(f=>f.replace(/\s/g,""));if(!o||!a)continue;if(o.length>1&&t)throw new Error("Invalid union symbol: Must be only one character. ({SYMBOL}={UNION})");i[o]=new Set(a.split(""));continue}n.push(U(r,t))}return{sequences:n,unions:i}}h.processSequences=w;function U(e,t=!0){let n={type:"standard",rules:[]};e.toLowerCase().startsWith("one")&&(n.type="one",e=e.slice(3).trim()),e.toLowerCase().startsWith("random")&&(n.type="random",e=e.slice(6).trim());for(let i of K(e)){let[r,s]=i.replace(/\s+/g," ").replace(/(\s*)=(\s*)/,"=").split(" "),o=r.replace(/\s/g,"").split("=");if(o[0]===o[1])continue;if(o.length!==2){if(t)throw new Error("Rules must follow format: {FROM}={TO}");o.push("")}let a={type:"one",from:o[0],to:o[1],steps:$(s,t)};if(a.steps.all&&(a.type="all"),o[0].length!==o[1].length&&t)throw new Error(`{FROM} and {TO} patterns must be equal in length: ${r}`);for(let f=0;f<o[0].length;f++)if((o[0][f]==="/"&&o[1][f]!=="/"||o[0][f]!=="/"&&o[1][f]==="/")&&t)throw new Error(`Step characters (/) must occur in the same positions: ${r}`);n.rules.push(a)}return n}function K(e){return e.split(",").map(t=>t.trim())}function $(e,t=!0){let n={count:0};if(!e)return n;if(e.startsWith("#")===!1){if(t)throw new Error(`Steps must start with '#', (${e})`);return n}if(e==="#ALL")return n.all=!0,n;if(e.includes("..")){let r=e.split(".."),[s,o]=[Number(r[0]),Number(r[1])];if(isNaN(s)||isNaN(o)){if(t)throw new Error("Step range must be formatted: #{FROM}..{TO}");return n}if(s>o||s<0||o<0){if(t)throw new Error("Invalid step range: {FROM} must be below {TO} and both values must be above 0");return n}return n.max=R(s,o),n.seed=()=>R(s,o),n}let i=Number(e.slice(1));if(isNaN(i)){if(t)throw new Error("Invalid step: Must follow be one of: #ALL, #{int}, #{from}..{to}");return n}return n.max=i,n}function R(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function E(e){for(let t=e.length-1;t>0;t--){let n=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[n],e[n]=i}return e}});var Z=g(G=>{Object.defineProperty(G,"__esModule",{value:!0});var O=N();onmessage=({data:{model:e,type:t}})=>{if(t==="slow"){(0,O.slowGenerate)(e,i=>postMessage(i));return}let n=(0,O.generate)(e);postMessage(n)}});Z();})();
//# sourceMappingURL=grids.js.map
